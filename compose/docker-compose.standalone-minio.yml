# Trino with standalone MinIO (deployed via Terraform)
# Usage: docker compose -f docker-compose.yml -f docker-compose.standalone-minio.yml up -d trino
#
# Required environment variables:
#   MINIO_HOST    - MinIO server IP (default: 10.0.0.10)
#   S3_ACCESS_KEY - MinIO access key (default: minioadmin)
#   S3_SECRET_KEY - MinIO secret key
#
# Example:
#   export MINIO_HOST=10.0.0.10
#   export S3_ACCESS_KEY=minioadmin
#   export S3_SECRET_KEY=minioadmin123
#   pnpm compose:up:trino:standalone-minio

services:
  # Disable local MinIO - using standalone MinIO
  minio:
    image: busybox:1.37
    command: ["true"]
    deploy:
      replicas: 0

  # Skip bucket creation - will be created by Trino/Iceberg
  create-minio-bucket:
    image: busybox:1.37
    command: ["true"]
    deploy:
      replicas: 0

  trino:
    environment:
      - MINIO_HOST=${MINIO_HOST:-10.0.0.10}
      - S3_ACCESS_KEY=${S3_ACCESS_KEY:-minioadmin}
      - S3_SECRET_KEY=${S3_SECRET_KEY}
    volumes:
      # Override catalog config to use standalone MinIO
      - ./trino/catalog/iceberg.standalone-minio.properties:/etc/trino/catalog/iceberg.properties:ro
      # Override exchange manager to use standalone MinIO
      - ./trino/exchange-manager.standalone-minio.properties:/etc/trino/exchange-manager.properties:ro
    depends_on:
      nessie:
        condition: service_healthy
